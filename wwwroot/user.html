<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
    <style>
        /* –ò–ó–û–õ–ò–†–û–í–ê–ù–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø USER */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .user-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .user-title {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .user-section {
            margin: 25px 0;
        }

        .user-section-title {
            color: #34495e;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .user-form-group {
            margin-bottom: 15px;
        }

        .user-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .user-select {
            width: 100%;
            padding: 10px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
        }

        .user-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            margin: 5px;
        }

        .user-btn-primary {
            background: #3498db;
            color: white;
        }

            .user-btn-primary:hover {
                background: #2980b9;
            }

        .user-btn-success {
            background: #27ae60;
            color: white;
        }

            .user-btn-success:hover {
                background: #229954;
            }

        .user-btn-warning {
            background: #f39c12;
            color: white;
        }

            .user-btn-warning:hover {
                background: #e67e22;
            }

        .user-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .cartridge-item {
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            background: white;
        }

        .cartridge-name {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.3em;
        }

        .status-available {
            color: #27ae60;
            font-weight: bold;
        }

        .status-unavailable {
            color: #e74c3c;
            font-weight: bold;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="user-container">
        <h1 class="user-title">üñ®Ô∏è –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>

        <div class="nav-buttons">
            <button class="user-btn user-btn-primary" onclick="goBack()">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</button>
        </div>

        <div class="user-section">
            <h2 class="user-section-title">üîç –ü–æ–∏—Å–∫ –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—Ä–∏–¥–∂–µ–π</h2>

            <div class="user-form-group">
                <label class="user-label">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–Ω—Ç–µ—Ä:</label>
                <select class="user-select" id="printerSelect" onchange="showCartridges()">
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–Ω—Ç–µ—Ä --</option>
                    <option value="1">LaserJet Pro M404</option>
                    <option value="2">Color LaserJet Pro M255</option>
                    <option value="3">WorkForce Pro WF-4740</option>
                    <option value="4">Laser MF244dw</option>
                </select>
            </div>

            <div class="user-form-group">
                <label class="user-label">–ò–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—Ä–∏–¥–∂:</label>
                <select class="user-select" id="cartridgeSelect" onchange="showSelectedCartridge()">
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—Ä–∏–¥–∂ --</option>
                    <option value="HP 83X Black">HP 83X Black</option>
                    <option value="HP 83X Color">HP 83X Color</option>
                    <option value="Epson 79N Black">Epson 79N Black</option>
                    <option value="Canon 747">Canon 747</option>
                </select>
            </div>
        </div>

        <div id="searchResults"></div>
    </div>

    <script>
        // JavaScript –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ –∫–∞–∫ –±—ã–ª
        function goBack() {
            window.location.href = "login.html";
        }

        function getPrinterName(printerId) {
            const printers = {
                1: 'LaserJet Pro M404',
                2: 'Color LaserJet Pro M255',
                3: 'WorkForce Pro WF-4740',
                4: 'Laser MF244dw'
            };
            return printers[printerId] || `–ü—Ä–∏–Ω—Ç–µ—Ä ${printerId}`;
        }

        async function showCartridges() {
            const printerId = document.getElementById('printerSelect').value;
            if (!printerId) return;

            try {
                const response = await fetch('https://localhost:7061/api/cartridges');
                const cartridges = await response.json();

                const results = cartridges.filter(c => c.printerId == printerId);
                displayResults(results, `–ö–∞—Ä—Ç—Ä–∏–¥–∂–∏ –¥–ª—è –ø—Ä–∏–Ω—Ç–µ—Ä–∞: ${getPrinterName(parseInt(printerId))}`);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('searchResults').innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>';
            }
        }

        async function showSelectedCartridge() {
            const cartridgeModel = document.getElementById('cartridgeSelect').value;
            if (!cartridgeModel) return;

            try {
                const response = await fetch('https://localhost:7061/api/cartridges');
                const cartridges = await response.json();

                const results = cartridges.filter(c => c.cartridgeModel === cartridgeModel);
                displayResults(results, `–ö–∞—Ä—Ç—Ä–∏–¥–∂: ${cartridgeModel}`);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('searchResults').innerHTML = '<p>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>';
            }
        }

        function displayResults(results, title) {
            let html = `<h3 class="user-section-title">${title}</h3>`;

            if (results.length === 0) {
                html += '<p>üì≠ –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
            } else {
                results.forEach(cartridge => {
                    const canBook = cartridge.availableQuantity > 0;
                    const canCancel = cartridge.bookedQuantity > 0;

                    html += `
                            <div class="cartridge-item">
                                <h4 class="cartridge-name">${cartridge.cartridgeModel}</h4>
                                <strong>üñ®Ô∏è –î–ª—è –ø—Ä–∏–Ω—Ç–µ—Ä–∞:</strong> ${getPrinterName(cartridge.printerId)}<br>
                                <strong>üì¶ –í—Å–µ–≥–æ:</strong> ${cartridge.totalQuantity} —à—Ç.<br>
                                <strong>üìã –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ:</strong> ${cartridge.bookedQuantity} —à—Ç.<br>
                                <strong class="${canBook ? 'status-available' : 'status-unavailable'}">
                                    ‚úÖ –°–≤–æ–±–æ–¥–Ω–æ: ${cartridge.availableQuantity} —à—Ç.
                                </strong><br>

                                <button class="user-btn user-btn-success" onclick="bookCartridge(${cartridge.id})"
                                        ${!canBook ? 'disabled' : ''}>
                                    üìã –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å
                                </button>

                                <button class="user-btn user-btn-warning" onclick="cancelBooking(${cartridge.id})"
                                        ${!canCancel ? 'disabled' : ''}>
                                    ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å
                                </button>
                            </div>
                        `;
                });
            }

            document.getElementById('searchResults').innerHTML = html;
        }

        async function bookCartridge(cartridgeId) {
            try {
                const response = await fetch(`https://localhost:7061/api/cartridges/book/${cartridgeId}`, {
                    method: 'POST'
                });

                const result = await response.json();
                alert(`‚úÖ ${result.message}`);
                refreshCurrentView();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏');
            }
        }

        async function cancelBooking(cartridgeId) {
            try {
                const response = await fetch(`https://localhost:7061/api/cartridges/cancel/${cartridgeId}`, {
                    method: 'POST'
                });

                const result = await response.json();
                alert(`‚úÖ ${result.message}`);
                refreshCurrentView();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –±—Ä–æ–Ω–∏:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –±—Ä–æ–Ω–∏');
            }
        }

        function refreshCurrentView() {
            const printerSelect = document.getElementById('printerSelect');
            const cartridgeSelect = document.getElementById('cartridgeSelect');

            if (printerSelect.value) {
                showCartridges();
            } else if (cartridgeSelect.value) {
                showSelectedCartridge();
            } else {
                loadAllCartridges();
            }
        }

        async function loadAllCartridges() {
            try {
                const response = await fetch('https://localhost:7061/api/cartridges');
                const cartridges = await response.json();

                displayResults(cartridges, '–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–∞—Ä—Ç—Ä–∏–¥–∂–∏:');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.getElementById('searchResults').innerHTML =
                    '<p>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', loadAllCartridges);
    </script>
</body>
</html>